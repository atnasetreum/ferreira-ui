(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[384],{6393:function(e,r,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/rutas",function(){return l(2010)}])},2010:function(e,r,l){"use strict";l.r(r),l.d(r,{default:function(){return ed}});var t=l(5893),n=l(6863),i=l(1057),s=l(6886),a=l(7294),c=l(629),o=l(1903),d=l(5248),x=l(9521),u=l(7179),h=l(9272),m=l(9294),j=l(6963),g=l(7145),p=l.n(g),f=l(1733),v=l(3946),Z=l(7906),y=l(295),b=l(2882),k=l(3184),w=l(2610);let P=e=>{let{columns:r,form:l,form:{sellers:n},setForm:i}=e,s=a.useCallback(e=>e.id,[]),{getTableProps:c,getTableBodyProps:o,headerGroups:h,rows:m,prepareRow:g}=(0,x.useTable)({data:n,columns:r,getRowId:s}),f=(e,r)=>{let t=n[e];i({...l,sellers:p()(n,{$splice:[[e,1],[r,0,t]]}).map((e,r)=>({...e,order:r+1}))})};return(0,t.jsx)(u.W,{backend:j.PD,children:(0,t.jsxs)(Z.Z,{...c(),children:[(0,t.jsx)(k.Z,{children:h.map(e=>{let{key:r,...l}=e.getHeaderGroupProps();return(0,t.jsxs)(d.AF,{...l,children:[(0,t.jsx)(d.Yk,{}),e.headers.map(e=>{let{key:r,...l}=e.getHeaderProps();return(0,t.jsx)(d.Yk,{align:"center",...l,children:e.render("Header")},r)})]},r)})}),(0,t.jsx)(y.Z,{...o(),children:m.map((e,r)=>null!==g(e)&&g(e)||(0,t.jsx)(S,{index:r,row:e,moveRow:f,...e.getRowProps()}))})]})})},S=e=>{let{row:r,index:l,moveRow:n}=e,i=a.useRef(null),s=a.useRef(null),[,c]=(0,h.L)({accept:"row",hover(e,r){if(!i.current)return;let t=e.index;if(t===l)return;let s=i.current.getBoundingClientRect(),a=(s.bottom-s.top)/2,c=r.getClientOffset(),o=c.y-s.top;t<l&&o<a||t>l&&o>a||(n(t,l),e.index=l)}}),[{isDragging:o},x,u]=(0,m.c)({type:"row",item:{type:"row",index:l},collect:e=>({isDragging:e.isDragging()})});return u(c(i)),x(s),(0,t.jsxs)(d.AF,{ref:i,style:{opacity:o?0:1},children:[(0,t.jsx)(d.Yk,{align:"center",ref:s,children:(0,t.jsx)(w.Z,{})}),r.cells.map(e=>{let{key:r,...l}=e.getCellProps();return(0,t.jsx)(d.Yk,{align:"center",...l,children:e.render("Cell")},r)})]})},C=e=>{let{sellers:r,form:l,setForm:i}=e,s=a.useMemo(()=>[{Header:"Orden",accessor:"order"},{Header:"UUID",accessor:"uuid"},{Header:"Seller",accessor:"nombre"},{Header:"Acciones",accessor:"id",Cell:e=>(0,t.jsx)(n.Z,{"aria-label":"outlined primary button group",children:(0,t.jsx)(v.Z,{color:"error","aria-label":"delete row",component:"label",onClick:()=>{i({...l,sellers:l.sellers.filter(r=>r.id!==e.row.original.id).map((e,r)=>({...e,order:r+1}))})},children:(0,t.jsx)(f.Z,{})})})}],[l,i]);return(0,t.jsx)(b.Z,{children:(0,t.jsx)(P,{columns:s,form:l,setForm:i})})};var A=l(8719),F=l(8110),z=l(2359),D=l(5188),Y=l(3345),N=l(6818),R=l(6470),I=l(2974),H=l(3343),B=l(1459),_=l(7494);let U={date:new Date,driver:null,sellers:[],notes:"",placa:null,pago:""},E=e=>{let{setAction:r,routeSelected:l,setRouteSelected:x,getAllRoutes:u}=e,[h,m]=(0,a.useState)(U),[j,g]=(0,a.useState)(null),[p,f]=(0,a.useState)(0),{notify:v}=(0,I.d$)();(0,a.useEffect)(()=>{j&&!h.sellers.find(e=>Number(e.id)===Number(j.id))&&(m({...h,sellers:[...h.sellers,{...j,id:"".concat(j.id),order:h.sellers.length+1}]}),g(null))},[j,h]),(0,a.useEffect)(()=>{Object.keys(l).length&&!p&&(m({date:(0,B.j5)(l.date),driver:{id:l.user.id,name:l.user.name},sellers:l.sellers.map((e,r)=>({id:e.seller.id.toString(),uuid:e.seller.uuid,nombre:e.seller.nombre,order:r+1})),notes:l.notes,placa:l.car,pago:l.pago}),f(l.id))},[l,p]);let Z=()=>{if(!h.placa)return v("Seleccione una placa");if(!h.date)return v("Seleccione una fecha");if("Invalid Date"===h.date.toString())return v("Formato de fecha invalido");if(!h.driver)return v("Seleccione un driver");let e=h.pago.trim();if(!e&&!p)return v("Agregue un pago");if(!h.sellers.length)return v("Seleccione los sellers de la ruta");if(p){var l;R.pg.update(p,{carId:h.placa.id,date:h.date,userId:h.driver.id,sellers:h.sellers.map(e=>Number(e.id)),notes:null===(l=h.notes)||void 0===l?void 0:l.trim(),pago:e}).then(()=>{v("Ruta actualizada correctamente","success"),r(""),x({}),u()}).catch(e=>{var r,l;return v((null===(r=e.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.message)||e.message)})}else R.pg.create({carId:h.placa.id,date:h.date,userId:h.driver.id,sellers:h.sellers.map(e=>Number(e.id)),notes:h.notes.trim(),pago:e}).then(()=>{v("Ruta creada correctamente","success"),r(""),u()}).catch(e=>{var r,l;return v((null===(r=e.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.message)||e.message)})};return(0,t.jsxs)(s.ZP,{container:!0,spacing:1,children:[(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(_.D,{value:h.placa,onChange:e=>m({...h,placa:e})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:2,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(z._,{dateAdapter:F.H,locale:Y.Z,children:(0,t.jsx)(D.M,{label:"Fecha",inputFormat:"dd/MM/yyyy",value:h.date,onChange:e=>m({...h,date:e}),renderInput:e=>(0,t.jsx)(o.Z,{...e,fullWidth:!0})})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:2,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(A.Z,{value:h.driver,onChange:e=>m({...h,driver:e})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:2,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(d.h1,{value:j,onChange:g,idsDisabled:h.sellers.map(e=>Number(e.id))})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(o.Z,{label:"Pago",variant:"outlined",fullWidth:!0,type:"number",autoComplete:"off",value:h.pago,onChange:e=>{let{target:{value:r}}=e;return m({...h,pago:r})}})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(o.Z,{label:"Notas adicionales",multiline:!0,rows:2,maxRows:4,fullWidth:!0,value:h.notes,onChange:e=>{let{target:{value:r}}=e;return m({...h,notes:r})}})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsxs)(n.Z,{"aria-label":"outlined primary button group",fullWidth:!0,children:[(0,t.jsx)(i.Z,{variant:"outlined",fullWidth:!0,startIcon:(0,t.jsx)(H.Z,{}),sx:{mt:1},onClick:()=>{r(""),x({})},children:"Cancelar"}),(0,t.jsx)(i.Z,{variant:"contained",fullWidth:!0,startIcon:(0,t.jsx)(N.Z,{}),sx:{mt:1},onClick:Z,children:"Guardar"})]})}),!!h.sellers.length&&(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(C,{sellers:h.sellers,form:h,setForm:m})})})]})};var L=l(7357),O=l(7922),G=l(5861),W=l(5503),M=l(813),T=l(1664),Q=l.n(T),X=l(2665),$=l(9529),q=l(7279);let K=$.mM.create({body:{paddingTop:35,paddingBottom:65,paddingHorizontal:35},title:{fontSize:18,textAlign:"center",fontFamily:"Oswald"},author:{fontSize:12,textAlign:"center",marginBottom:20},subtitle:{fontSize:15,margin:2,fontFamily:"Oswald"},subtitleLarge:{fontSize:20,margin:2,fontFamily:"Oswald"},text:{margin:12,fontSize:14,textAlign:"justify",fontFamily:"Times-Roman"},image:{marginHorizontal:120,width:280,height:200},imageQr:{marginHorizontal:150,width:250,height:150},imageRef:{marginHorizontal:50,width:250,height:150},header:{fontSize:12,marginBottom:5,textAlign:"center",color:"grey"},pageNumber:{position:"absolute",fontSize:12,bottom:30,left:0,right:0,textAlign:"center",color:"grey"},link:{fontFamily:"Lato",fontSize:10,color:"black",textDecoration:"none",alignSelf:"flex-end",justifySelf:"flex-end"}});$.Zx.register({family:"Oswald",src:"https://fonts.gstatic.com/s/oswald/v13/Y_TKV6o8WovbUd3m_X9aAA.ttf"});let V=e=>{let{children:r,...l}=e;return(0,t.jsx)($.xv,{style:K.subtitle,...l,children:r})},J=e=>{let{route:r}=e;return(0,t.jsx)($.BB,{children:(0,t.jsxs)($.T3,{size:"A4",style:K.body,wrap:!0,children:[(0,t.jsx)($.xv,{style:K.header,fixed:!0,children:"~ Ruta  ~"}),(0,t.jsxs)($.xv,{style:K.header,fixed:!0,children:[r.user.name," - ",(0,B.p6)(r.date)]}),(0,t.jsx)(V,{children:"Driver"}),(0,t.jsx)($.xv,{style:K.text,children:r.user.name}),(0,t.jsx)(V,{children:"No. de puntos en la ruta"}),(0,t.jsx)($.xv,{style:K.text,children:r.sellers.length}),(0,t.jsx)(V,{children:"Ciclo"}),(0,t.jsx)($.xv,{style:K.text,children:r.ciclo}),(0,t.jsx)(V,{children:"Fecha de la ruta"}),(0,t.jsx)($.xv,{style:K.text,children:(0,B.p6)(r.date)}),(0,t.jsx)(V,{children:"Nota:"}),(0,t.jsx)($.xv,{style:K.text,children:r.notes}),(0,t.jsx)(V,{children:"Logistica:"}),(0,t.jsx)($.xv,{style:K.text,children:r.car.logistica.name}),(0,t.jsx)(V,{children:"Placa:"}),(0,t.jsx)($.xv,{style:K.text,children:r.car.placa}),(0,t.jsx)($.Ee,{style:K.imageQr,src:(0,q.F)(r.car.image,"cars")}),r.sellers.map((e,r)=>{let{seller:l}=e;return(0,t.jsxs)($.G7,{break:!0,wrap:!1,children:[(0,t.jsx)($.xv,{style:K.subtitleLarge,children:(0,t.jsx)($.rU,{src:l.linkUbicacion,children:"Punto ".concat(r+1)})}),(0,t.jsxs)(V,{children:[l.nombre," - ",l.uuid]}),(0,t.jsx)($.Ee,{style:K.image,src:(0,q.F)(l.image)}),(0,t.jsx)(V,{children:"Telefonos"}),l.referencePhones.length?(0,t.jsx)($.G7,{style:{flexDirection:"column"},children:l.referencePhones.map(e=>(0,t.jsxs)($.G7,{style:{flexDirection:"row",marginBottom:4},children:[(0,t.jsx)($.xv,{style:{marginHorizontal:8},children:"•"}),(0,t.jsxs)($.xv,{style:{fontSize:12},children:[e.name," - ",e.phone]})]},e.id))}):(0,t.jsx)($.G7,{style:{flexDirection:"column"},children:(0,t.jsxs)($.G7,{style:{flexDirection:"row",marginBottom:4},children:[(0,t.jsx)($.xv,{style:{marginHorizontal:8},children:"•"}),(0,t.jsx)($.xv,{style:{fontSize:12},children:"Sin telefonos"})]})}),(0,t.jsx)(V,{children:"Referencias"}),l.references.length?(0,t.jsx)($.G7,{style:{flexDirection:"column"},children:l.references.map(e=>(0,t.jsxs)($.G7,{children:[(0,t.jsxs)($.G7,{style:{flexDirection:"row",marginBottom:4},children:[(0,t.jsx)($.xv,{style:{marginHorizontal:8},children:"•"}),(0,t.jsxs)($.xv,{style:{fontSize:12},children:[e.description," ",e.link&&" - "," ",e.link&&(0,t.jsx)($.rU,{src:e.link,children:"Ubicacion"})]})]}),e.image&&(0,t.jsx)($.Ee,{style:K.imageRef,src:(0,q.F)(e.image)})]},e.id))}):(0,t.jsx)($.G7,{style:{flexDirection:"column"},children:(0,t.jsxs)($.G7,{style:{flexDirection:"row",marginBottom:4},children:[(0,t.jsx)($.xv,{style:{marginHorizontal:8},children:"•"}),(0,t.jsx)($.xv,{style:{fontSize:12},children:"Sin referencias"})]})}),l.personaQueAtiende&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V,{children:"Persona que atiende"}),(0,t.jsx)($.xv,{style:K.text,children:l.personaQueAtiende})]}),(0,t.jsx)(V,{children:"Direccion"}),(0,t.jsxs)($.xv,{style:K.text,children:[l.calle," ",l.numero," ",l.colonia,", ",l.ciudad,", ",l.cp," ",l.municipio,", ",l.estado]})]},l.id)}),(0,t.jsx)($.xv,{style:K.pageNumber,render:e=>{let{pageNumber:r,totalPages:l}=e;return"".concat(r," / ").concat(l)},fixed:!0})]})})};var ee=l(3162),er=l(7957),el=l(9091),et=l(7586);function en(e){let{row:r,removeRoute:l,setAction:i,setRouteSelected:s}=e,[c,o]=a.useState(!1),x=async e=>{let l=await (0,$.eA)((0,t.jsx)(J,{route:r})).toBlob();(0,ee.saveAs)(l,e)};return(0,t.jsxs)(a.Fragment,{children:[(0,t.jsxs)(d.AF,{sx:{"& > *":{borderBottom:"unset"}},children:[(0,t.jsx)(d.Yk,{children:(0,t.jsx)(v.Z,{"aria-label":"expand row",size:"small",onClick:()=>o(!c),children:c?(0,t.jsx)(M.Z,{}):(0,t.jsx)(W.Z,{})})}),(0,t.jsx)(d.Yk,{component:"th",scope:"row",children:r.id}),(0,t.jsx)(d.Yk,{children:r.car.logistica.name}),(0,t.jsx)(d.Yk,{children:r.car.placa}),(0,t.jsx)(d.Yk,{children:(0,B.p6)(r.date)}),(0,t.jsx)(d.Yk,{children:r.user.name}),(0,t.jsx)(d.Yk,{children:r.sellers.length}),(0,t.jsx)(d.Yk,{children:r.ciclo}),(0,t.jsx)(d.Yk,{children:el.z.format(Number(r.pago))}),(0,t.jsx)(d.Yk,{children:(0,B.jH)(r.createdAt)}),(0,t.jsx)(d.Yk,{children:(0,B.jH)(r.updatedAt)}),(0,t.jsx)(d.Yk,{align:"center",children:(0,t.jsxs)(n.Z,{"aria-label":"outlined primary button group",children:[(0,t.jsx)(v.Z,{color:"error","aria-label":"delete row",component:"label",onClick:()=>x("".concat((0,B.p6)(r.date)," - ").concat(r.user.name," - Ciclo ").concat(r.ciclo,".pdf")),children:(0,t.jsx)(X.Z,{color:"error"})}),(0,t.jsx)(v.Z,{color:"warning","aria-label":"delete row",component:"label",onClick:()=>{s(r),i("edit")},children:(0,t.jsx)(er.Z,{})}),(0,t.jsx)(v.Z,{color:"error","aria-label":"delete row",component:"label",onClick:()=>l(r.id),children:(0,t.jsx)(f.Z,{})})]})})]}),(0,t.jsx)(d.AF,{children:(0,t.jsx)(d.Yk,{style:{paddingBottom:0,paddingTop:0},colSpan:12,children:(0,t.jsx)(O.Z,{in:c,timeout:"auto",unmountOnExit:!0,children:(0,t.jsxs)(L.Z,{sx:{margin:1},children:[(0,t.jsx)(G.Z,{variant:"h6",gutterBottom:!0,component:"div",children:"Puntos"}),(0,t.jsxs)(Z.Z,{size:"small","aria-label":"purchases",children:[(0,t.jsx)(k.Z,{children:(0,t.jsxs)(d.AF,{children:[(0,t.jsx)(d.Yk,{children:"Punto"}),(0,t.jsx)(d.Yk,{children:"UUID"}),(0,t.jsx)(d.Yk,{children:"NOMBRE"}),(0,t.jsx)(d.Yk,{children:"UBICACION"})]})}),(0,t.jsx)(y.Z,{children:r.sellers.map((e,r)=>(0,t.jsxs)(d.AF,{children:[(0,t.jsx)(d.Yk,{component:"th",scope:"row",children:r+1}),(0,t.jsx)(d.Yk,{children:e.seller.uuid}),(0,t.jsx)(d.Yk,{children:e.seller.nombre}),(0,t.jsx)(d.Yk,{children:(0,t.jsx)(Q(),{href:e.seller.linkUbicacion,target:"_blank",children:e.seller.linkUbicacion})})]},e.id))})]})]})})})})]})}var ei=function(e){let{setAction:r,setRouteSelected:l,filters:n,routes:i,getAllRoutes:s}=e,{notify:a}=(0,I.d$)(),c=e=>{R.pg.remove(e).then(()=>{s(),a("Ruta eliminada correctamente","success")}).catch(e=>{var r,l;return a((null===(r=e.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.message)||e.message)})};return(0,t.jsx)(et.Z,{rows:i,columns:["","ID","Logistica","Placa","Fecha de ruta","Driver","No. de puntos","Ciclo","Pago","Fecha Creacion","Ultima actualizacion","Acciones"],renderListItem:e=>(0,t.jsx)(en,{row:e,removeRoute:c,setAction:r,setRouteSelected:l},e.id)})},es=l(3318),ea=l(5843),ec=l(4162);let eo=e=>{let{filters:r,setFilters:l}=e;return(0,t.jsxs)(s.ZP,{container:!0,spacing:1,children:[(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsxs)(G.Z,{variant:"subtitle1",gutterBottom:!0,children:["Filtros ",(0,t.jsx)(ec.Z,{})]})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:1,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(o.Z,{type:"number",label:"ID",variant:"outlined",fullWidth:!0,value:r.id,onChange:e=>{let{target:{value:t}}=e;return l({...r,id:t})}})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(d.yO,{value:r.logistica,onChange:e=>l({...r,logistica:e})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(d.DA,{value:r.placa,onChange:e=>l({...r,placa:e})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(A.Z,{value:r.driver,onChange:e=>l({...r,driver:e})})})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:6,lg:2,children:(0,t.jsx)(c.Z,{children:(0,t.jsx)(z._,{dateAdapter:F.H,locale:Y.Z,children:(0,t.jsx)(D.M,{label:"Fecha",inputFormat:"dd/MM/yyyy",value:r.date,onChange:e=>l({...r,date:e}),renderInput:e=>(0,t.jsx)(o.Z,{...e,fullWidth:!0})})})})})]})};var ed=function(){let[e,r]=(0,a.useState)(""),[l,c]=(0,a.useState)({}),[o,d]=(0,a.useState)({id:"",date:new Date,driver:null,logistica:null,placa:null}),[x,u]=(0,a.useState)([]),h=()=>R.pg.getAll({...o.id&&{id:o.id},...o.date&&{date:o.date},...o.driver&&{driverId:o.driver.id},...o.placa&&{carId:o.placa.id},...o.logistica&&{logisticaId:o.logistica.id}}).then(u);return(0,a.useEffect)(()=>{h()},[o]),(0,t.jsx)(es.Z,{title:"Rutas",children:(0,t.jsxs)(s.ZP,{container:!0,spacing:1,children:[""===e&&(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(n.Z,{variant:"contained","aria-label":"outlined primary button group",children:(0,t.jsx)(i.Z,{startIcon:(0,t.jsx)(ea.Z,{}),onClick:()=>r("add"),children:"Agregar"})})}),["add","edit"].includes(e)&&(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(E,{setAction:r,routeSelected:l,setRouteSelected:c,getAllRoutes:h})}),""===e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(eo,{filters:o,setFilters:d})}),(0,t.jsx)(s.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,t.jsx)(ei,{filters:o,setAction:r,setRouteSelected:c,routes:x,getAllRoutes:h})})]})]})})}},1459:function(e,r,l){"use strict";l.d(r,{a8:function(){return c},j5:function(){return a},jH:function(){return i},p6:function(){return s}});var t=l(381),n=l.n(t);l(5655);let i=e=>n()(e).format("LLLL a"),s=e=>n()(e).format("LL"),a=e=>{let[r,l,t]=e.split("-");return new Date(Number(r),Number(l)-1,Number(t))},c=(e,r)=>n()(e).format(r)},7279:function(e,r,l){"use strict";l.d(r,{F:function(){return t}});let t=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sellers";return"https://api.transportesferreira.com/static/images/".concat(r,"/").concat(e)}},9091:function(e,r,l){"use strict";l.d(r,{z:function(){return t}});let t=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"})},2480:function(){}},function(e){e.O(0,[885,186,445,111,999,681,102,633,849,649,110,540,468,476,318,774,888,179],function(){return e(e.s=6393)}),_N_E=e.O()}]);